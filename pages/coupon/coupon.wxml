<!--pages/coupon/coupon.wxml-->
<view class="coupon-container">
  
  <!-- Tabåˆ‡æ¢ - ç²¾ç®€ä¸ºä¸¤ä¸ªæ ¸å¿ƒçŠ¶æ€ -->
  <view class="tab-container">
    <view class="tab-item {{selectedTab === 0 ? 'active' : ''}}" 
          data-index="0" bindtap="switchTab">
      <view class="tab-text">å¯é¢†å–</view>
      <view class="tab-subtext">AVAILABLE</view>
    </view>
    <view class="tab-item {{selectedTab === 1 ? 'active' : ''}}" 
          data-index="1" bindtap="switchTab">
      <view class="tab-text">æˆ‘çš„ä¼˜æƒ åˆ¸</view>
      <view class="tab-subtext">MY COUPONS</view>
    </view>
  </view>

  <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
  <view class="coupon-list">
    
    <!-- å¯é¢†å–ä¼˜æƒ åˆ¸ -->
    <block wx:if="{{selectedTab === 0}}">
      <view class="coupon-item available" 
            wx:for="{{coupons}}" 
            wx:key="id"
            data-id="{{item.id}}"
            bindtap="viewCouponDetail">
        
        <!-- è¶…å¤§é‡‘é¢ç„¦ç‚¹åŒºåŸŸ -->
        <view class="coupon-amount-focus">
          <view class="amount-display">
            <text class="amount-symbol">{{item.showCurrency ? 'Â¥' : ''}}</text>
            <text class="amount-number">{{item.displayAmount}}</text>
          </view>
          <view class="amount-condition">æ»¡{{item.minAmount}}å¯ç”¨</view>
        </view>
        
        <!-- ä¼˜æƒ åˆ¸ä¿¡æ¯ -->
        <view class="coupon-content">
          <view class="coupon-title">{{item.title}}</view>
          <view class="coupon-desc">{{item.description}}</view>
          <view class="coupon-meta">
            <view class="expire-info">æœ‰æ•ˆæœŸè‡³ {{item.expireTime}}</view>
            <view class="remain-count">å‰©ä½™ {{item.remainCount}} å¼ </view>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="coupon-action">
          <view class="claim-btn {{item.isClaimed ? 'claimed' : ''}}" 
                data-id="{{item.id}}" 
                catchtap="{{item.isClaimed ? '' : 'claimCoupon'}}">
            {{item.isClaimed ? 'å·²é¢†å–' : 'é¢†å–'}}
          </view>
        </view>
      </view>
    </block>

    <!-- å·²é¢†å–ä¼˜æƒ åˆ¸ -->
    <block wx:if="{{selectedTab === 1}}">
      <view class="coupon-item claimed" 
            wx:for="{{receivedCoupons}}" 
            wx:key="id"
            data-id="{{item.id}}"
            bindtap="viewCouponDetail">
        
        <!-- è¶…å¤§é‡‘é¢ç„¦ç‚¹åŒºåŸŸ -->
        <view class="coupon-amount-focus claimed">
          <view class="amount-display">
            <text class="amount-symbol">{{item.showCurrency ? 'Â¥' : ''}}</text>
            <text class="amount-number">{{item.displayAmount}}</text>
          </view>
          <view class="amount-condition">æ»¡{{item.minAmount}}å¯ç”¨</view>
        </view>
        
        <!-- ä¼˜æƒ åˆ¸ä¿¡æ¯ -->
        <view class="coupon-content">
          <view class="coupon-title">{{item.title}}</view>
          <view class="coupon-desc">{{item.description}}</view>
          <view class="coupon-meta">
            <view class="expire-info">æœ‰æ•ˆæœŸè‡³ {{item.expireTime}}</view>
            <view class="status-badge claimed">å·²é¢†å–</view>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="coupon-action">
          <view class="use-btn" 
                data-id="{{item.id}}" 
                catchtap="useCoupon">
            ä½¿ç”¨
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{(selectedTab === 0 && coupons.length === 0) || (selectedTab === 1 && receivedCoupons.length === 0)}}">
    <view class="empty-icon">ğŸ«</view>
    <view class="empty-text">{{selectedTab === 0 ? 'æš‚æ— å¯é¢†å–ä¼˜æƒ åˆ¸' : 'æš‚æ— å·²é¢†å–ä¼˜æƒ åˆ¸'}}</view>
    <view class="empty-subtext">{{selectedTab === 0 ? 'NO AVAILABLE COUPONS' : 'NO CLAIMED COUPONS'}}</view>
    <view class="empty-action" wx:if="{{selectedTab === 0}}" bindtap="refreshCoupons">
      <text class="action-text">åˆ·æ–°ä¼˜æƒ åˆ¸</text>
    </view>
  </view>

  <!-- æ¶ˆæ¯æç¤º -->
  <toast />

</view> 