<!-- pages/review/history/history.wxml -->
<view class="history-container">
  
  <!-- é¡µé¢æ ‡é¢˜åŒº - Appleé£æ ¼ -->
  <view class="page-header {{animationStates.headerVisible ? 'visible' : ''}}">
    <view class="header-content">
      <view class="header-icon">ğŸ“</view>
      <view class="header-title">æˆ‘çš„è¯„ä»·å†å²</view>
      <view class="header-subtitle">å›é¡¾æ‚¨çš„çè´µç‚¹è¯„æ—¶å…‰</view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="stats-card card {{animationStates.statsVisible ? 'visible' : ''}}" wx:if="{{stats.totalReviews > 0}}">
    <view class="stats-grid">
      <view class="stats-item">
        <view class="stats-number">{{stats.totalReviews}}</view>
        <view class="stats-label">æ€»è¯„ä»·æ•°</view>
      </view>
      <view class="stats-item">
        <view class="stats-number">{{stats.averageRating}}</view>
        <view class="stats-label">å¹³å‡è¯„åˆ†</view>
      </view>
      <view class="stats-item">
        <view class="stats-number">{{stats.bestRating}}</view>
        <view class="stats-label">æœ€é«˜è¯„åˆ†</view>
      </view>
      <view class="stats-item">
        <view class="stats-number">{{stats.worstRating}}</view>
        <view class="stats-label">æœ€ä½è¯„åˆ†</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar card {{animationStates.statsVisible ? 'visible' : ''}}" wx:if="{{stats.totalReviews > 0}}">
    <view class="filter-title">ç­›é€‰è¯„åˆ†</view>
    <view class="filter-buttons">
      <view 
        class="filter-btn {{filterRating === 0 ? 'active' : ''}}"
        data-rating="0"
        bindtap="onFilterRating"
      >å…¨éƒ¨</view>
      <view 
        class="filter-btn {{filterRating === index + 1 ? 'active' : ''}}"
        wx:for="{{[1,2,3,4,5]}}" 
        wx:key="filter{{item}}"
        data-rating="{{item}}"
        bindtap="onFilterRating"
      >{{item}}æ˜Ÿ</view>
    </view>
  </view>



  <!-- è¯„ä»·åˆ—è¡¨ -->
  <view class="review-list {{animationStates.listVisible ? 'visible' : ''}}">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-card card" wx:if="{{loading}}">
      <view class="loading-content">
        <view class="loading-icon">â³</view>
        <view class="loading-text">åŠ è½½ä¸­...</view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-card card" wx:if="{{!loading && reviewList.length === 0}}">
      <view class="empty-content">
        <view class="empty-icon">ğŸ“­</view>
        <view class="empty-title">æš‚æ— è¯„ä»·è®°å½•</view>
        <view class="empty-subtitle">å¿«å»ç•™ä¸‹æ‚¨çš„ç¬¬ä¸€ä¸ªè¯„ä»·å§</view>
        <button class="btn-primary" bindtap="onNewReview">
          ç«‹å³è¯„ä»·
        </button>
      </view>
    </view>

    <!-- è¯„ä»·å¡ç‰‡åˆ—è¡¨ -->
    <view wx:for="{{reviewList}}" wx:key="id" class="review-item-card card">
      <!-- å¡ç‰‡å¤´éƒ¨ -->
      <view class="review-header">
        <view class="review-date-time">
          <view class="review-date">{{item.date}}</view>
          <view class="review-time">{{item.time}}</view>
        </view>
        <view class="review-average">
          <view class="average-score">{{item.averageRating}}</view>
          <view class="average-label">å¹³å‡åˆ†</view>
        </view>
      </view>

      <!-- ä¸‰ç»´åº¦è¯„åˆ† -->
      <view class="review-ratings">
        <view class="rating-dimension">
          <view class="dimension-name">æ€»ä½“æ»¡æ„åº¦ ({{item.overallRating}}åˆ†)</view>
          <view class="dimension-stars">
            <text class="mini-star {{index < item.overallRating ? 'active' : ''}}" wx:for="{{[1,2,3,4,5]}}" wx:key="*this">â˜†</text>
          </view>
        </view>
        <view class="rating-dimension">
          <view class="dimension-name">æœåŠ¡è´¨é‡ ({{item.serviceRating}}åˆ†)</view>
          <view class="dimension-stars">
            <text class="mini-star {{index < item.serviceRating ? 'active' : ''}}" wx:for="{{[1,2,3,4,5]}}" wx:key="*this">â˜†</text>
          </view>
        </view>
        <view class="rating-dimension">
          <view class="dimension-name">ç¯å¢ƒè®¾æ–½ ({{item.environmentRating}}åˆ†)</view>
          <view class="dimension-stars">
            <text class="mini-star {{index < item.environmentRating ? 'active' : ''}}" wx:for="{{[1,2,3,4,5]}}" wx:key="*this">â˜†</text>
          </view>
        </view>
      </view>

      <!-- æ ‡ç­¾æ˜¾ç¤º -->
      <view class="review-tags" wx:if="{{item.tags && item.tags.length > 0}}">
        <view class="tag-label">æ ‡ç­¾ï¼š</view>
        <view class="tags-container">
          <text class="review-tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
        </view>
      </view>

      <!-- æ–‡å­—è¯„ä»· -->
      <view class="review-text" wx:if="{{item.textReview}}">
        <view class="text-label">è¯„ä»·å†…å®¹ï¼š</view>
        <view class="text-content">{{item.textReview}}</view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="review-actions">
        <button class="btn-delete" data-id="{{item.id}}" bindtap="onDeleteReview">åˆ é™¤</button>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="bottom-actions" wx:if="{{!loading}}">
    <button class="btn-secondary" bindtap="onBackToReview">
      è¿”å›è¯„ä»·
    </button>
    <button class="btn-primary" bindtap="onNewReview">
      æ–°å»ºè¯„ä»·
    </button>
  </view>

</view> 