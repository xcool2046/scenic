<view class="orders-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:elif="{{isEmpty}}">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-title">æš‚æ— è®¢å•</text>
    <text class="empty-subtitle">å¿«å»è´­ä¹°æ™¯åŒºé—¨ç¥¨å§ï¼</text>
    <view class="empty-action">
      <view class="action-btn primary" bindtap="goToBuyTickets">
        <text>ç«‹å³è´­ç¥¨</text>
      </view>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="orders-list" wx:else>
    <view class="order-card" 
          wx:for="{{orders}}" 
          wx:key="order_id">
      
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-info">
          <text class="order-number">è®¢å• {{item.order_no || item.order_id}}</text>
          <text class="order-date">{{item.create_time || item.order_date}}</text>
        </view>
        <view class="order-status {{getOrderStatusClass(item.status)}}">
          <text>{{getOrderStatusText(item.status)}}</text>
        </view>
      </view>

      <!-- è®¢å•å†…å®¹ -->
      <view class="order-content" bindtap="viewOrderDetail" data-id="{{item.order_id}}">
        <view class="ticket-info">
          <text class="ticket-name">{{item.ticket_name}}</text>
          <text class="ticket-details">
            æ•°é‡ï¼š{{item.quantity}}å¼  | æ¸¸è§ˆæ—¥æœŸï¼š{{item.visit_date}}
          </text>
          <text class="contact-info" wx:if="{{item.contact_name}}">
            è”ç³»äººï¼š{{item.contact_name}} {{item.contact_phone}}
          </text>
        </view>
        <view class="order-amount">
          <text class="amount-label">å®ä»˜</text>
          <text class="amount-value">Â¥{{item.total_price}}</text>
        </view>
      </view>

      <!-- è®¢å•æ“ä½œ -->
      <view class="order-actions">
        <!-- å¾…æ”¯ä»˜çŠ¶æ€çš„æ“ä½œ -->
        <block wx:if="{{item.status === 'UNPAID'}}">
          <view class="action-btn secondary small" 
                bindtap="deleteOrder" 
                data-id="{{item.order_id}}">å–æ¶ˆè®¢å•</view>
          <view class="action-btn primary small" 
                bindtap="continuePay" 
                data-id="{{item.order_id}}">ç»§ç»­æ”¯ä»˜</view>
        </block>

        <!-- å·²æ”¯ä»˜çŠ¶æ€çš„æ“ä½œ -->
        <block wx:elif="{{item.status === 'PAID'}}">
          <view class="action-btn secondary small" 
                bindtap="requestRefund" 
                data-id="{{item.order_id}}">ç”³è¯·é€€æ¬¾</view>
          <view class="action-btn primary small" 
                bindtap="viewTicketCode" 
                data-order="{{item}}">æŸ¥çœ‹ç¥¨ç </view>
        </block>

        <!-- å·²ä½¿ç”¨çŠ¶æ€çš„æ“ä½œ -->
        <block wx:elif="{{item.status === 'USED'}}">
          <view class="action-btn secondary small" 
                bindtap="viewOrderDetail" 
                data-id="{{item.order_id}}">æŸ¥çœ‹è¯¦æƒ…</view>
        </block>

        <!-- é€€æ¬¾ä¸­çŠ¶æ€çš„æ“ä½œ -->
        <block wx:elif="{{item.status === 'REFUNDING'}}">
          <view class="action-btn secondary small disabled">
            <text>é€€æ¬¾å¤„ç†ä¸­</text>
          </view>
        </block>

        <!-- å·²é€€æ¬¾/å·²å–æ¶ˆçŠ¶æ€çš„æ“ä½œ -->
        <block wx:elif="{{item.status === 'REFUNDED' || item.status === 'CANCELLED'}}">
          <view class="action-btn secondary small" 
                bindtap="deleteOrder" 
                data-id="{{item.order_id}}">åˆ é™¤è®¢å•</view>
          <view class="action-btn secondary small" 
                bindtap="goToBuyTickets">å†æ¬¡è´­ä¹°</view>
        </block>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="bottom-tips" wx:if="{{!loading && !isEmpty}}">
    <text class="tips-text">ä¸‹æ‹‰å¯ä»¥åˆ·æ–°è®¢å•çŠ¶æ€</text>
  </view>
</view> 