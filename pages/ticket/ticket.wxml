<!-- packages/ticket/pages/ticket/ticket.wxml -->
<view class="page-container">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="header-title">
      <text class="main-title">景区门票</text>
      <text class="subtitle">选择适合您的门票类型</text>
    </view>
    <view class="header-action">
      <view class="order-btn" bindtap="viewMyOrders">
        <text class="order-btn-text">我的订单</text>
      </view>
    </view>
  </view>

  <!-- 票种选择区域 -->
  <view class="section-container">
    <view class="ticket-grid">
      <view class="ticket-card {{item.selected ? 'selected' : ''}}" 
            wx:for="{{tickets}}" 
            wx:key="id"
            bindtap="selectTicket"
            data-id="{{item.id}}">
        
        <!-- 票种标题区 -->
        <view class="ticket-header">
          <view class="ticket-name">{{item.name}}</view>
          <view class="ticket-price-container">
            <text class="current-price">¥{{item.price}}</text>
            <text class="original-price">¥{{item.originalPrice}}</text>
          </view>
        </view>
        
        <!-- 票种描述 -->
        <view class="ticket-description">{{item.description}}</view>
        
        <!-- 票种特性 -->
        <view class="ticket-features">
          <text class="feature-item" wx:for="{{item.features}}" wx:for-item="feature" wx:key="*this">
            {{feature}}
          </text>
        </view>
        
        <!-- 重要说明 -->
        <view class="ticket-notice">{{item.notice}}</view>
        
        <!-- 优惠标签 -->
        <view class="discount-badge">{{item.discount}}</view>
        
        <!-- 选中指示器 -->
        <view class="selection-indicator" wx:if="{{item.selected}}">
          <text class="check-icon">✓</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 购买配置区域 -->
  <view class="section-container">
    <view class="section-title">购买信息</view>
    
    <!-- 数量选择 -->
    <view class="config-item">
      <view class="config-label">购买数量</view>
      <view class="quantity-control">
        <view class="quantity-btn {{quantity <= 1 ? 'disabled' : ''}}" 
              bindtap="changeQuantity" 
              data-type="minus">−</view>
        <view class="quantity-display">{{quantity}}</view>
        <view class="quantity-btn {{quantity >= 10 ? 'disabled' : ''}}" 
              bindtap="changeQuantity" 
              data-type="add">+</view>
      </view>
    </view>
    
    <!-- 日期选择 -->
    <view class="config-item">
      <view class="config-label">游览日期</view>
      <picker mode="date" 
              value="{{visitDate}}" 
              start="{{visitDate}}" 
              end="2024-12-31" 
              bindchange="bindDateChange">
        <view class="date-selector">
          <text class="date-text">{{visitDate || '请选择日期'}}</text>
          <text class="arrow-icon">›</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- 总价展示和购买按钮 -->
  <view class="purchase-section">
    <view class="price-summary">
      <text class="price-label">总计</text>
      <text class="total-amount">¥{{totalPrice}}</text>
    </view>
    <view class="purchase-btn" bindtap="buyNow">
      <text>立即购买</text>
    </view>
  </view>

  <!-- 购买表单弹窗 -->
  <view class="purchase-modal {{showPurchaseForm ? 'show' : ''}}" wx:if="{{showPurchaseForm}}">
    <view class="modal-overlay" bindtap="cancelPurchase"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">填写购票信息</text>
        <text class="modal-close" bindtap="cancelPurchase">×</text>
      </view>
      
      <view class="form-section">
        <view class="form-item">
          <text class="form-label">联系人姓名</text>
          <input class="form-input" 
                 placeholder="请输入联系人姓名" 
                 value="{{contactInfo.name}}" 
                 bindinput="onContactInput"
                 data-field="name" />
        </view>
        
        <view class="form-item">
          <text class="form-label">联系电话</text>
          <input class="form-input" 
                 type="number" 
                 maxlength="11"
                 placeholder="请输入手机号码" 
                 value="{{contactInfo.phone}}" 
                 bindinput="onContactInput"
                 data-field="phone" />
        </view>
      </view>
      
      <view class="modal-summary">
        <view class="summary-item">
          <text class="summary-label">门票类型</text>
          <text class="summary-value">{{selectedTicket.name}}</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">购买数量</text>
          <text class="summary-value">{{quantity}}张</text>
        </view>
        <view class="summary-item">
          <text class="summary-label">游览日期</text>
          <text class="summary-value">{{visitDate}}</text>
        </view>
        <view class="summary-item total">
          <text class="summary-label">支付金额</text>
          <text class="summary-value">¥{{totalPrice}}</text>
        </view>
      </view>
      
      <view class="modal-actions">
        <view class="action-btn secondary" bindtap="cancelPurchase">取消</view>
        <view class="action-btn primary" bindtap="confirmPayment">确认支付</view>
      </view>
    </view>
  </view>

  <!-- 购票须知 -->
  <view class="section-container notice-section">
    <view class="section-title">购票须知</view>
    <view class="notice-content">
      <view class="notice-item">• 门票当天有效，请按选定日期入园游览</view>
      <view class="notice-item">• 儿童票适用于6-17周岁，入园需出示相关证件</view>
      <view class="notice-item">• 老人票需持有效身份证或老年证入园</view>
      <view class="notice-item">• 家庭套票限定人数使用，不可拆分</view>
      <view class="notice-item">• 如需退款请在游览日期前1天申请</view>
    </view>
  </view>
</view>
