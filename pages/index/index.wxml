<!--index.wxml-->
<view class="container">
  <!-- 轮播图 -->
  <view class="banner-container">
    <swiper 
      class="banner-swiper" 
      indicator-dots="{{indicatorDots}}"
      indicator-color="rgba(255, 255, 255, 0.5)"
      indicator-active-color="#ffffff"
      autoplay="{{autoplay}}" 
      interval="{{interval}}" 
      duration="{{duration}}"
      circular="{{circular}}"
      previous-margin="{{previousMargin}}"
      next-margin="{{nextMargin}}"
      easing-function="easeInOutCubic"
      bindchange="onBannerChange"
    >
      <block wx:for="{{bannerList}}" wx:key="id">
        <swiper-item>
          <view class="banner-item {{currentBannerIndex === index ? 'active' : ''}}">
            <image 
              src="{{item.url}}" 
              class="banner-image" 
              mode="aspectFill"
              bindtap="onBannerTap"
              data-id="{{item.id}}"
              bindload="onBannerImageLoad"
              binderror="onBannerImageError"
            ></image>
            <view class="banner-title" wx:if="{{item.title}}">{{item.title}}</view>
          </view>
        </swiper-item>
      </block>
    </swiper>
    
    <!-- 自定义指示器 -->
    <view class="banner-indicator" wx:if="{{!indicatorDots && bannerList.length > 1}}">
      <block wx:for="{{bannerList}}" wx:key="id">
        <view class="indicator-dot {{currentBannerIndex === index ? 'active' : ''}}"></view>
      </block>
    </view>
  </view>

  <!-- 基本信息面板 -->
  <view class="info-panel">
    <view class="info-item" wx:if="{{uiConfig.showWeather}}">
      <view class="info-label">天气</view>
      <view class="info-value">{{weatherInfo.temperature}} · {{weatherInfo.weather}}</view>
    </view>
    <view class="info-divider" wx:if="{{uiConfig.showWeather && uiConfig.showCrowdLevel}}"></view>
    <view class="info-item" wx:if="{{uiConfig.showCrowdLevel}}">
      <view class="info-label">人流量</view>
      <view class="info-value">{{crowdInfo.level}}</view>
    </view>
    <view class="info-divider"></view>
    <view class="info-item">
      <view class="info-label">开放时间</view>
      <view class="info-value">{{openStatus.time}}{{!openStatus.isOpen ? ' (已闭园)' : ''}}</view>
    </view>
  </view>

  <!-- 核心服务卡片 -->
  <view class="service-cards">
    <view class="service-card ticket" bindtap="onCommonTap" data-type="ticket" style="background-image: url('{{images.CARDS.TICKET}}')">
      <view class="service-content">
        <view class="icon-base icon-responsive icon-circle icon-primary">
          <image class="icon-image" src="{{icons.CDN_ICONS.TICKET}}"></image>
        </view>
        <text class="service-title">电子门票</text>
      </view>
    </view>
    <view class="service-card map" bindtap="onCommonTap" data-type="map" style="background-image: url('{{images.CARDS.MAP}}')">
      <view class="service-content">
        <view class="icon-base icon-responsive icon-circle icon-primary">
          <image class="icon-image" src="{{icons.CDN_ICONS.MAP}}"></image>
        </view>
        <text class="service-title">景区地图</text>
      </view>
    </view>
  </view>

  <!-- 7个码上服务 -->
  <view class="smart-services">
    <view class="section-header">
      <text class="section-title">智慧服务</text>
      <text class="section-subtitle">一码通行 · 智享服务</text>
    </view>
    
    <!-- 第一行：扫码进码（大卡片，跨两列） -->
    <view class="service-row-main">
      <view class="service-main-item" bindtap="onServiceTap" data-service="scan">
        <view class="service-main-content">
          <view class="service-main-icon">
            <image src="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/icons/qrcode.svg" mode="aspectFit"></image>
          </view>
          <view class="service-main-info">
            <text class="service-main-name">扫码进码</text>
            <text class="service-main-desc">二维码验票入园</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 第二行：码上评价 + 码上惠客 -->
    <view class="service-row">
      <view class="service-item" bindtap="onServiceTap" data-service="review">
        <view class="service-icon">
          <image src="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/icons/star.svg" mode="aspectFit"></image>
        </view>
        <view class="service-info">
          <text class="service-name">码上评价</text>
          <text class="service-desc">服务评价反馈</text>
        </view>
      </view>
      
      <view class="service-item" bindtap="onServiceTap" data-service="coupon">
        <view class="service-icon">
          <image src="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/icons/discount-2.svg" mode="aspectFit"></image>
        </view>
        <view class="service-info">
          <text class="service-name">码上惠客</text>
          <text class="service-desc">优惠券与积分</text>
        </view>
      </view>
    </view>
    
    <!-- 第三行：码上消费 + 码上导游 -->
    <view class="service-row">
      <view class="service-item" bindtap="onServiceTap" data-service="shopping">
        <view class="service-icon">
          <image src="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/icons/shopping-cart.svg" mode="aspectFit"></image>
        </view>
        <view class="service-info">
          <text class="service-name">码上消费</text>
          <text class="service-desc">在线购买服务</text>
        </view>
      </view>
      
      <view class="service-item" bindtap="onServiceTap" data-service="audio-guide">
        <view class="service-icon">
          <image src="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/icons/headphones.svg" mode="aspectFit"></image>
        </view>
        <view class="service-info">
          <text class="service-name">码上导游</text>
          <text class="service-desc">智能语音导览</text>
        </view>
      </view>
    </view>
    
    <!-- 第四行：码上监管 + 码上合作 -->
    <view class="service-row">
      <view class="service-item" bindtap="onServiceTap" data-service="management">
        <view class="service-icon">
          <image src="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/icons/shield-check.svg" mode="aspectFit"></image>
        </view>
        <view class="service-info">
          <text class="service-name">码上监管</text>
          <text class="service-desc">服务质量监控</text>
        </view>
      </view>
      
      <view class="service-item" bindtap="onServiceTap" data-service="merchant">
        <view class="service-icon">
          <image src="https://cdn.jsdelivr.net/npm/@tabler/icons@2.47.0/icons/building-store.svg" mode="aspectFit" binderror="onIconError"></image>
        </view>
        <view class="service-info">
          <text class="service-name">码上合作</text>
          <text class="service-desc">商家入驻合作</text>
        </view>
      </view>
    </view>
  </view>







  <!-- 底部空白区域，防止内容被底部tab遮挡 -->
  <view class="bottom-gap"></view>
  
  <!-- 加载中提示 -->
  <view class="loading-timeout" wx:if="{{loadingTimeout}}">
    <text>数据加载失败</text>
    <view class="retry-btn" bindtap="refreshHomeData">重新加载</view>
  </view>
</view>
